var assessmentSdk=function(){"use strict";var t="my-plugin-",e="http://127.0.0.1:5000",n={questionaireId:null,questionIds:[],prevQuestions:{}},o=[{value:1,text:"Multi choice","data-label":"multi"},{value:2,text:"Single choice","data-label":"single"},{value:3,text:"Yes/No Question"},{value:4,text:"Short Answer"},{value:5,text:"Long Answer"}],s={screening:1};function i(e){var n=[];return e.forEach(function(e){e=t+e,n.push(e)}),n.join(" ")}function a(e){return t+e}function u(t,e,n){var o=$("<"+t+"></"+t+">");return e&&e.length&&o.addClass(i(e)),n&&o.attr("id",a(n)),o}function r(t,e,n,o,s){var i=u("div",["checkbox-wrapper"]),a=u("input",["checkbox-input"]).attr({id:t,type:"checkbox",name:e,value:n,"data-label":o}),r=u("label",["checkbox-label"]).attr({for:t}).text(s);return i.html(a[0].outerHTML+r[0].outerHTML),i[0].outerHTML}function d(t){var e=u("div",["slide-wrapper"]),n=u("div",["slide-toggle-button"]).text("view options"),o=u("div",["options-wrapper"]),s="";return t.forEach(function(t){var e=u("div",["option-row"]).text(t);s+=e[0].outerHTML}),o.html(s),e.html(n[0].outerHTML+o[0].outerHTML),e[0].outerHTML}function c(t){t.on("click","."+i(["slide-toggle-button"]),function(t){t.stopPropagation(),$(this).next().slideToggle()})}function l(t,e){if(t){var n,o=e||0,s="";for(n=0;n<t;n++){var i=u("div",["options-textarea-wrapper"]),a=u("textarea",["textarea","small","optionsTextarea"]).attr({placeholder:"Option "+(o+1)});o++;var r=u("span",["cross-button","deleteOptionButton","icon-cross"]).addClass("hidden");i.html(a[0].outerHTML+r[0].outerHTML),s+=i[0].outerHTML}return s}}var p={};function v(t){p.addedQuestions=[],t.questionaire&&t.questionaire[0]&&(p.addedQuestions=t.questionaire[0].sections[0].questions),p.totalQuestAddedCount=p.addedQuestions.length,p.prevQuestions=t.prevQuestions,p.options=t.options,p.questionTextareaVal="",p.questTypeVal="multi",p.questionOptionsVal=[];var e,n=u("div",["wrapper"]);n.html(((e=u("div",["main-container"])).html(function(){var t,e,n=u("div",["heading"]).text(p.options.title),s=u("div",["sub-heading"]).text(p.options.subTitle),c=u("div",["added-quest-container"],"addedQuestContainer");c.html((t=u("div",["section-heading","totalQuestAdded"]).text("Your Added Questions ("+p.totalQuestAddedCount+"/10)"),e=u("div",["section-content"],"addedQuestContent"),p.totalQuestAddedCount&&e.html(b(p.addedQuestions)),t[0].outerHTML+e[0].outerHTML));var l=u("div",["action-button-container"],"actionButtonsContainer"),v=u("button",["button"],"addQuestButton").text("Add Question"),f=u("div",["container","addQuestContainer"],"addQuestContainer").addClass("hidden");f.html(function(){var t,e,n,s=u("div",["section-header"]),d=(t=o,e=u("select",["select-dropdown"],"questionType"),n="",t.forEach(function(t){var e=u("option",["option-row"]).attr({value:t.value,"data-label":t["data-label"]}).text(t.text);n+=e[0].outerHTML}),e.html(n),e[0].outerHTML),c=r(a("addQuestionHeader-isQuestMandatory"),null,null,null,"Mandatory");s.html(d+c);var l=u("div",["section-content"]);l.html(Q(p.questTypeVal));var v=u("div",["section-footer"]),f=u("button",["button"],"addQuestButtonModal").prop({disabled:!0}).text("Add").addClass(i(["disabled"])),h=u("button",["button","borderLess-button","cancel-container-button"]).text("Cancel");return v.html(f[0].outerHTML+h[0].outerHTML),s[0].outerHTML+l[0].outerHTML+v[0].outerHTML}());var h=v[0].outerHTML+f[0].outerHTML;if(p.prevQuestions.length){var q=u("span",["or-text"]).text("or"),C=u("button",["button"],"usePrevButton").text("Use previously used questions"),T=u("div",["container","usePrevQuestContainer"],"usePrevQuestContainer").addClass("hidden");T.html(function(t){var e,n=u("div",["section-heading"]).text("Use previously added question"),o=u("div",["section-content"]);o.html((e="",t.forEach(function(t){var n=u("div",["section-row"]).attr("data-questionId",t.id),o=r("addQuestSectionRow"+t.id,null,t.id,null,t.question),s="";s=t.answerOptions&&t.answerOptions.length?o+d(t.answerOptions):o,n.html(s),e+=n[0].outerHTML}),e));var s=u("div",["section-footer"]),i=u("button",["button","disabled"],"usePrevButtonModal").text("Add selected questions").prop("disabled",!0),a=u("button",["button","borderLess-button",,"cancel-container-button"]).text("Cancel"),c=u("div",["quest-added-text","totalQuestAdded"]).text("Your Added Questions: "+p.totalQuestAddedCount+"/10");return s.html(i[0].outerHTML+a[0].outerHTML+c[0].outerHTML),n[0].outerHTML+o[0].outerHTML+s[0].outerHTML}(p.prevQuestions)),h=v[0].outerHTML+q[0].outerHTML+C[0].outerHTML+f[0].outerHTML+T[0].outerHTML}return l.html(h),10==p.totalQuestAddedCount&&l.addClass("hidden"),p.totalQuestAddedCount||c.addClass("hidden"),n[0].outerHTML+s[0].outerHTML+c[0].outerHTML+l[0].outerHTML}()),e[0].outerHTML)),$("#"+t.options.wrapperName).html(n[0].outerHTML),p.addQuestContainer=$("#"+a("addQuestContainer")),p.usePrevQuestContainer=$("#"+a("usePrevQuestContainer")),p.addedQuestContainer=$("#"+a("addedQuestContainer")),p.usePrevButton=$("#"+a("usePrevButton")),p.addQuestButton=$("#"+a("addQuestButton")),p.addQuestButtonModal=$("#"+a("addQuestButtonModal")),p.questionTextarea=$("#"+a("questionTextarea")),p.questionType=$("#"+a("questionType")),p.usePrevButtonModal=$("#"+a("usePrevButtonModal")),p.questMandatory=$("#"+a("addQuestionHeader-isQuestMandatory")),p.addQuestOptionButton=$("#"+a("addQuestOptionButton")),p.actionButtonsContainer=$("#"+a("actionButtonsContainer")),p.addedQuestContent=$("#"+a("addedQuestContent")),p.optionsTextarea=$("."+i(["optionsTextarea"])),p.totalQuestAdded=$("."+i(["totalQuestAdded"])),p.addQuestButton.click(function(t){t.stopPropagation(),p.addQuestContainer.removeClass("hidden")}),$("body").click(function(){h()}),$("."+i(["container"])).click(function(t){t.stopPropagation()}),$("."+i(["cancel-container-button"])).click(function(t){t.stopPropagation(),h()}),c(p.usePrevQuestContainer),c(p.addedQuestContainer),p.usePrevButton.click(function(t){t.stopPropagation(),p.usePrevQuestContainer.removeClass("hidden")}),p.addQuestContainer.on("click","#"+a("addQuestOptionButton"),function(t){t.stopPropagation();var e=p.addQuestContainer.find("."+i(["optionsTextarea"])).length;p.addQuestContainer.find("."+i(["options-wrapper"])).append(l(1,e)),e>=2&&p.addQuestContainer.find("."+i(["deleteOptionButton"])).removeClass("hidden")}),p.questionType.change(function(t){p.questTypeVal=$(this).find("option:selected").attr("data-label")||"",p.addQuestContainer.find("."+i(["section-content"])).html(Q(p.questTypeVal)),p.addQuestButtonModal.addClass(i(["disabled"])),p.questionTextareaVal="",p.questionOptionsVal=[],p.questMandatory.prop("checked",!1)}),p.addQuestContainer.on("click","."+i(["deleteOptionButton"]),function(t){$(this).parent().remove();var e=p.addQuestContainer.find("."+i(["optionsTextarea"])).length;e<=2&&p.addQuestContainer.find("."+i(["deleteOptionButton"])).addClass("hidden")}),p.addQuestContainer.on("keyup","#"+a("questionTextarea"),function(){p.questionTextareaVal=$(this).val().trim(),f(p.questTypeVal)}),p.addQuestContainer.on("keyup","."+i(["optionsTextarea"]),function(){p.questionOptionsVal=[],$.each(p.addQuestContainer.find("."+i(["optionsTextarea"])).slice(0,2),function(t,e){p.questionOptionsVal.push($(e).val().trim())}),f(p.questTypeVal)}),p.addedQuestContainer.on("click","."+i(["editQuestIcon"]),function(){}),p.usePrevQuestContainer.on("click","."+i(["checkbox-input"]),function(t){if(t.stopPropagation(),$(this).is(":checked"))p.usePrevButtonModal.prop("disabled",!1).removeClass(i(["disabled"])),p.totalQuestAddedCount+=1,10==p.totalQuestAddedCount&&(p.usePrevQuestContainer.find("."+i(["checkbox-input"])).attr("disabled",!0),p.usePrevQuestContainer.find("."+i(["checkbox-input"])+":checked").attr("disabled",!1));else{var e=p.usePrevQuestContainer.find("."+i(["checkbox-input"])+":checked").length;e>0?p.usePrevButtonModal.prop("disabled",!1).removeClass(i(["disabled"])):p.usePrevButtonModal.prop("disabled",!0).addClass(i(["disabled"])),p.totalQuestAddedCount-=1,p.usePrevQuestContainer.find("."+i(["checkbox-input"])).attr("disabled",!1)}p.usePrevQuestContainer.find("."+i(["totalQuestAdded"])).text("Your Added Questions: "+p.totalQuestAddedCount+"/10")}),p.usePrevQuestContainer.on("click","."+i(["checkbox-label"]),function(t){t.stopPropagation()})}function f(t){var e=1;return p.questionTextareaVal||(e=0),-1!=["multi","single"].indexOf(t)&&(p.questionOptionsVal.length||(e=0),p.questionOptionsVal.forEach(function(t){t||(e=0)})),1==e?p.addQuestButtonModal.prop("disabled",!1).removeClass(i(["disabled"])):p.addQuestButtonModal.prop("disabled",!0).addClass(i(["disabled"]))}function h(){$("."+i(["container"])).addClass("hidden"),p.addQuestContainer.find("textarea").val(""),p.usePrevQuestContainer.find("."+i(["checkbox-input"])).prop("checked",!1),p.usePrevQuestContainer.find("."+i(["checkbox-input"])).prop("disabled",!1),p.addQuestButtonModal.addClass(i(["disabled"])),p.totalQuestAddedCount=n.questionIds.length,p.usePrevQuestContainer.find("."+i(["totalQuestAdded"])).text("Questions added: "+p.totalQuestAddedCount+"/10"),p.questionTextareaVal="",p.questionOptionsVal=[]}function b(t){var e="";return t.forEach(function(t){e+=function(t){var e=u("div",["section-row"]).attr("data-questionId",t.id),n=u("div",["sort-icon","icon-asterisk"]),o=u("div",["added-question-wrapper"]),s=u("div",["question-text"]).text(t.question),i="";if(t.answerOptions&&t.answerOptions.length){var a=d(t.answerOptions);i=s[0].outerHTML+a}else i=s[0].outerHTML;o.html(i);var r=u("div",["question-actions-container"]),c=u("div",["question-action-icon","mandatory-icon","icon-asterisk"]),l=u("div",["question-action-icon","edit-icon","editQuestIcon","icon-edit"]),p=u("div",["question-action-icon","delete-icon","deleteQuestIcon","icon-delete"]);0==t.mandatory&&c.addClass("hidden");return r.html(c[0].outerHTML+l[0].outerHTML+p[0].outerHTML),e.html(n[0].outerHTML+o[0].outerHTML+r[0].outerHTML),e[0].outerHTML}(t)}),e}function Q(t){var e=u("div",["text"]).text("Question Text*"),n=u("textarea",["textarea"],"questionTextarea").attr({placeholder:"What would you like to ask?"});if(-1!=["multi","single"].indexOf(t)){var o=u("div",["options-wrapper"]),s=l(2,0),i=u("button",["button","borderLess-button","add-quest-option"],"addQuestOptionButton").text("Add Option");return o.html(s),e[0].outerHTML+n[0].outerHTML+o[0].outerHTML+i[0].outerHTML}return e[0].outerHTML+n[0].outerHTML}function q(t){p.totalQuestAdded.text("Your Added Questions: "+t+"/10"),p.totalQuestAddedCount=t}function C(t,n,o,s){return postRequest(e+"/v1/questionaire/"+t+"/section/"+n+"/question",{"content-type":"application/json"},JSON.stringify(o),function(t,e,n){if(t.status&&"success"==t.status)return t.extraParameters=s,pubsub.publish("associatedQuestionWithQuestionaire",t)},function(t,e,n){return pubsub.publish("failedToAssociateQuestionWithQuestionaire",t)})}function T(t,n){return postRequest(e+"/v1/question",{"content-type":"application/json"},JSON.stringify(t),function(t,e,o){if(t.status&&"success"==t.status)return t.extraParameters=n,pubsub.publish("createdQuestion",t)},function(t,e,n){return pubsub.publish("failedToCreateQuestion",t)})}function x(t){return getRequest(e+"/v1/question",t,function(t){if(t.status&&"success"==t.status)return pubsub.publish("fetchedQuestions",t)},function(t,e,n){return pubsub.publish("failedToFetchQuestions",t)})}function m(t,n){return postRequest(e+"/v1/questionaire",{"content-type":"application/json"},JSON.stringify(t),function(t,e,o){if(t.status&&"success"==t.status)return t.extraParameters=n,pubsub.publish("createdQuestionaire",t)},function(t,e,n){return pubsub.publish("failedToCreateQuestionaire",t)})}var M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};pubsub.subscribe("fetchedQuestionaireDetails",function(t,e){if(e.options&&(n.options=e.options),e.questionaire&&e.questionaire.length&&(n.questionaireId=e.questionaire[0].id,e.questionaire[0].sections[0].questions.forEach(function(t){n.questionIds.push(t.id)})),e.prevQuestions.length){var o=[];e.prevQuestions.forEach(function(t){-1==n.questionIds.indexOf(t.id)&&(o.push(t),n.prevQuestions[t.id]=t)}),e.prevQuestions=o}var u,r,d,c;v(e),u=function(t){var e={};e.questionIds=t;var o={};o.questionIds=t,o.origin="sortable",C(n.questionaireId,0,e,o)},Sortable.create(p.addedQuestContent[0],{handle:"."+i(["sort-icon"]),animation:150,ghostClass:i(["ghost"]),onEnd:function(t){var e=[];$.each(p.addedQuestContent.find("."+i(["section-row"])),function(t,n){e.push($(n).attr("data-questionId"))}),u(e)}}),r=function(t){var e={};e.questionIds=n.questionIds.concat(t);var o={};if(o.prevQuestionIds=t,o.origin="prevUsed",o.data=e,!n.questionaireId)return m({author:n.options.author,tags:n.options.tags,authorType:n.options.authorType,invocation:s.screening,association:n.options.association,sections:[{type:"static",questionIds:[]}]},o);C(n.questionaireId,0,e,o)},p.usePrevButtonModal.click(function(t){t.stopPropagation();var e=p.usePrevQuestContainer.find("."+i(["checkbox-input"])+":checked"),n=[];$.each(e,function(t,e){n.push($(e).val())}),r(n)}),d=function(t){var e={};if(e.questionData=t,!n.questionaireId)return m({author:n.options.author,tags:n.options.tags,authorType:n.options.authorType,invocation:s.screening,association:n.options.association,sections:[{type:"static",questionIds:[]}]},e);T(t,e)},p.addQuestButtonModal.click(function(t){t.stopPropagation();var e={};e.question=$($("#"+a("questionTextarea"))[0]).val().trim(),e.type=parseInt(p.questionType.val());var n=[];$.each(p.addQuestContainer.find("."+i(["optionsTextarea"])),function(t,e){n.push($(e).val())}),e.answerOptions=n,e.author=p.options.author,e.mandatory=p.questMandatory.is(":checked"),d(e)}),c=function(t){var e={};e.questionIds=n.questionIds;var o=e.questionIds.indexOf(t);-1!==o&&e.questionIds.splice(o,1);var s={origin:"delete"};s.questionId=t,C(n.questionaireId,0,e,s)},p.addedQuestContainer.on("click","."+i(["deleteQuestIcon"]),function(){var t=$(this).closest("."+i(["section-row"])).attr("data-questionId");c(t)})}),pubsub.subscribe("failedToFetchQuestionaireDetails",function(t,e){});pubsub.subscribe("createdQuestionaire",function(t,e){n.questionaireId=e.data;var o={};if("prevUsed"==e.extraParameters.origin){var s=e.extraParameters.data;return o.prevQuestionIds=e.extraParameters.prevQuestionIds,o.origin="prevUsed",C(n.questionaireId,0,s,o)}o.questionData=e.extraParameters.questionData,T(e.extraParameters.questionData,o)}),pubsub.subscribe("failedToCreateQuestionaire",function(t,e){});pubsub.subscribe("createdQuestion",function(t,e){var o={};o.questionIds=n.questionIds.concat(e.data);var s={};s.questionData=e.extraParameters.questionData,s.questionData.id=e.data,s.questionId=e.data,s.origin="newlyAdded",C(n.questionaireId,0,o,s)}),pubsub.subscribe("failedToCreateQuestion",function(t,e){});pubsub.subscribe("associatedQuestionWithQuestionaire",function(t,e){if("delete"==e.extraParameters.origin){var o=n.questionIds.indexOf(e.extraParameters.questionId);return-1!==o&&n.questionIds.splice(o,1),n.questionIds.length<10&&p.actionButtonsContainer.removeClass("hidden"),0==n.questionIds.length&&p.addedQuestContainer.addClass("hidden"),q(n.questionIds.length),s=e.extraParameters.questionId,void p.addedQuestContainer.find("."+i(["section-row"])+"[data-questionId="+s+"]").remove()}var s;if("sortable"==e.extraParameters.origin)return alert("successfully sorted");var a,u=[];"prevUsed"==e.extraParameters.origin&&(n.questionIds=n.questionIds.concat(e.extraParameters.prevQuestionIds),e.extraParameters.prevQuestionIds.forEach(function(t){var e;u.push(n.prevQuestions[t]),e=t,p.usePrevQuestContainer.find("."+i(["section-row"])+"[data-questionId="+e+"]").remove(),delete n.prevQuestions[t]}),0===Object.keys(n.prevQuestions).length&&n.prevQuestions.constructor===Object&&(p.usePrevButton.addClass("hidden"),p.actionButtonsContainer.find("."+i(["or-text"])).addClass("hidden"))),"newlyAdded"==e.extraParameters.origin&&(n.questionIds=n.questionIds.concat(e.extraParameters.questionId),u.push(e.extraParameters.questionData)),q(n.questionIds.length),a=u,p.addedQuestContainer.find("."+i(["section-content"])).append(b(a)).removeClass("hidden"),p.addedQuestContainer.removeClass("hidden"),n.questionIds.length>=10&&p.actionButtonsContainer.addClass("hidden"),h()}),pubsub.subscribe("failedToAssociateQuestionWithQuestionaire",function(t,e){});return function(t){var n={};t&&"object"===(void 0===t?"undefined":M(t))&&(n=function(t,e){var n;for(n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}({title:"Screening Questions",subTitle:"You can ask some questions before the candidates apply to your job!"},t));var o={author:n.author};if(n.association){var i,a={association:n.association,invocation:s.screening};$.when((i=a,getRequest(e+"/v1/questionaire",i,function(t){if(t.status&&"success"==t.status)return pubsub.publish("fetchedQuestionaire",t)},function(t,e,n){return pubsub.publish("failedToFetchQuestionaire",t)})),x(o)).then(function(t,e){if(t[0]&&e[0]&&"success"==t[0].status&&"success"==e[0].status){var o={questionaire:t[0].data,prevQuestions:e[0].data,options:n};return pubsub.publish("fetchedQuestionaireDetails",o)}},function(t,e,n){return pubsub.publish("failedToFetchQuestionaireDetails",t)})}else $.when(null,x(o)).then(function(t,e){if(e[0]&&"success"==e[0].status){var o={prevQuestions:e[0].data,options:n};return pubsub.publish("fetchedQuestionaireDetails",o)}},function(t,e,n){return pubsub.publish("failedToFetchQuestionaireDetails",t)})}}();
